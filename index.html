<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Model Inspector | ูุงุดู ุงูููุฏููุงุช</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Tajawal', sans-serif; background: #0f172a; color: white; }</style>
</head>
<body class="min-h-screen p-8">

<div class="max-w-3xl mx-auto space-y-8">
    
    <!-- Header -->
    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
        <h1 class="text-2xl font-bold mb-4 text-blue-400">๐ต๏ธ ูุงุดู ุงูููุฏููุงุช ูุงูุตูุงุญูุงุช</h1>
        <div class="flex gap-2">
            <input type="password" id="apiKey" placeholder="ุถุน ููุชุงุญ API ููุง..." class="flex-1 bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white">
        </div>
    </div>

    <!-- Test 1: List Models -->
    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">1. ุงุฎุชุจุงุฑ ุงููุงุฆูุฉ (ูุงุฐุง ูุฑู ููุชุงุญูุ)</h2>
            <button onclick="listModels()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-lg font-bold">ุฌูุจ ุงููุงุฆูุฉ</button>
        </div>
        <p class="text-slate-400 text-sm mb-4">ูุฐุง ุงูุงุฎุชุจุงุฑ ุณูุฌูุจ ุงููุงุฆูุฉ ุงูุฑุณููุฉ ูู ุฌูุฌู. ุงุจุญุซ ุนู ุงุณู ุงูููุฏูู ุงูุฎุงุต ุจู ููุง.</p>
        
        <div id="listResult" class="bg-black rounded-xl p-4 h-64 overflow-y-auto font-mono text-xs text-green-400 border border-slate-900">
            ุจุงูุชุธุงุฑ ุงูุจุฏุก...
        </div>
    </div>

    <!-- Test 2: WebSocket Connection -->
    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">2. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุงููุจุงุดุฑ (Ping)</h2>
            <button onclick="testConnection()" class="bg-purple-600 hover:bg-purple-500 px-6 py-2 rounded-lg font-bold">ุงุชุตุงู ุชุฌุฑูุจู</button>
        </div>
        <div class="mb-4">
            <label class="text-xs text-slate-500 block mb-1">ุงุณู ุงูููุฏูู ุงููุฑุงุฏ ุงุฎุชุจุงุฑู:</label>
            <input type="text" id="targetModel" value="models/gemini-2.5-flash-native-audio-dialog" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 font-mono text-yellow-400">
        </div>
        <div id="connResult" class="p-4 rounded-xl bg-slate-900 border border-slate-700 min-h-[50px] flex items-center justify-center font-bold text-slate-500">
            ุงููุชูุฌุฉ ุณุชุธูุฑ ููุง...
        </div>
    </div>

</div>

<script>
    // --- Test 1: Fetch Models via REST API ---
    async function listModels() {
        const key = document.getElementById('apiKey').value;
        const out = document.getElementById('listResult');
        
        if(!key) { out.innerHTML = "โ ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูููุชุงุญ"; return; }
        
        out.innerHTML = "ุฌุงุฑู ุงูุงุชุตุงู ุจุฌูุฌู...";
        
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
            const data = await response.json();
            
            if(data.error) {
                out.innerHTML = `<span class="text-red-500">Error: ${JSON.stringify(data.error, null, 2)}</span>`;
            } else {
                // Highlight the target model if found
                const target = document.getElementById('targetModel').value.replace('models/', '');
                
                const formatted = data.models.map(m => {
                    const name = m.name.replace('models/', '');
                    if(name === target) return `<span class="text-yellow-400 font-bold bg-yellow-900/50 block p-1">โ FOUND: ${m.name}</span>`;
                    return `<span class="block py-0.5">${m.name}</span>`;
                }).join('');
                
                out.innerHTML = formatted;
            }
        } catch(e) {
            out.innerHTML = `<span class="text-red-500">Network Error: ${e.message}</span>`;
        }
    }

    // --- Test 2: WebSocket Handshake ---
    function testConnection() {
        const key = document.getElementById('apiKey').value;
        const model = document.getElementById('targetModel').value;
        const out = document.getElementById('connResult');
        
        if(!key) { out.innerHTML = "โ ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูููุชุงุญ"; return; }

        out.innerHTML = `<span class="text-yellow-500 animate-pulse">ุฌุงุฑู ูุชุญ ููุงุฉ ุงุชุตุงู WebSocket...</span>`;
        
        const url = `wss://generativelanguage.googleapis.com/ws/google.ai.generativelanguage.v1alpha.GenerativeService.BidiGenerateContent?key=${key}`;
        
        try {
            const ws = new WebSocket(url);

            ws.onopen = () => {
                out.innerHTML = `<span class="text-blue-400">ุชู ูุชุญ ุงูููุงุฉ. ุฌุงุฑู ุฅุฑุณุงู ูุตุงูุญุฉ ุงูุฅุนุฏุงุฏ (Setup)...</span>`;
                
                const msg = {
                    setup: {
                        model: model,
                        generation_config: { response_modalities: ["AUDIO"] }
                    }
                };
                ws.send(JSON.stringify(msg));
            };

            ws.onmessage = (evt) => {
                // If we get ANY message back, strictly speaking, the connection worked!
                // Even if it's text.
                try {
                    const data = JSON.parse(evt.data);
                    // Usually Google sends an empty object {} or setupComplete as confirmation
                    out.innerHTML = `<span class="text-green-400 text-lg">โ ูุฌุญ ุงูุงุชุตุงู! ุงูููุฏูู ุฑุฏ ุจูุจูู ุงูุฅุนุฏุงุฏุงุช.</span>`;
                    ws.close();
                } catch(e) {
                    // Blob handling
                    out.innerHTML = `<span class="text-green-400 text-lg">โ ูุฌุญ ุงูุงุชุตุงู! (ุชู ุงุณุชูุงู ุจูุงูุงุช).</span>`;
                    ws.close();
                }
            };

            ws.onclose = (evt) => {
                if(out.innerText.includes("ูุฌุญ")) return; // Already succeeded

                if(evt.code === 1000) {
                    out.innerHTML = `<span class="text-slate-400">ุชู ุฅุบูุงู ุงูุงุชุตุงู ุจุดูู ุทุจูุนู.</span>`;
                } else {
                    let reason = "ุณุจุจ ุบูุฑ ูุญุฏุฏ";
                    if(evt.code === 1006) reason = "ุงูููุฏูู ุฑูุถ ุงูุงุชุตุงู (ุบุงูุจุงู ุงูุงุณู ุฎุทุฃ ุฃู ุบูุฑ ูุชุงุญ ููุญุณุงุจ)";
                    if(evt.code === 1011) reason = "ุฎุทุฃ ุณูุฑูุฑ";
                    
                    out.innerHTML = `<span class="text-red-500 font-bold">โ ูุดู ุงูุงุชุตุงู. ุงูููุฏ: ${evt.code}<br>ุงูุณุจุจ ุงููุญุชูู: ${reason}</span>`;
                }
            };

            ws.onerror = (err) => {
                out.innerHTML = `<span class="text-red-500">โ ุฎุทุฃ ูู ุงูุดุจูุฉ (WebSocket Error).</span>`;
            };

        } catch(e) {
            out.innerHTML = `<span class="text-red-500">Error: ${e.message}</span>`;
        }
    }
</script>

</body>
</html>